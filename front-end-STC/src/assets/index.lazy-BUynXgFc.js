import{r,u as D,j as e,c as R}from"./index-BXzBXnnT.js";import{a as p}from"./axios-CCb-kr4I.js";const j="/assets/logo-BJ_IHRWf.svg",I=()=>{const[l,N]=r.useState(""),[c,v]=r.useState(""),[a,m]=r.useState(!1),[i,o]=r.useState(""),[x,C]=r.useState(!1),[d,S]=r.useState(""),[f,P]=r.useState(""),[b,B]=r.useState(!1),[A,u]=r.useState(!1),h=D();r.useEffect(()=>{(async()=>{try{const s=await p.get("http://localhost:8080/api/cloud/users");C(s.status===204)}catch(s){console.error("Error al verificar usuarios:",s)}})()},[]);const w=s=>{const n=/^(?=.*[A-Z])(?=.*\d)(?=.*[@$!¡%¿?()/=[\]{}&^¬#+-])[A-Za-z\d@$!¡%*¿?()/=[\]{}&^¬#+-]{6,10}$/;return s.length===0||s.length>10||!n.test(s)?(o("La contraseña solo permite letras (mayúsculas y minúsculas), números y símbolos, con una longitud entre 6 y 10 caracteres."),!1):(o(""),!0)},E=async s=>{if(s.preventDefault(),d!==f){o("Las contraseñas no coinciden");return}if(w(d))try{(await p.put(`http://localhost:8080/api/cloud/users/${l}/change-password`,{newPassword:d})).status===200&&(u(!1),h({to:"/home"}))}catch{o("Error al cambiar la contraseña")}},g=async s=>{var n,y;if(s.preventDefault(),w(c))if(x)try{const t=await p.post("http://localhost:8080/api/cloud/users",{username:l,password:c,password_changed:!1,rol:"ADMINISTRADOR"});t.status===201&&(t.data.requirePasswordChange?u(!0):(console.log("Usuario registrado exitosamente."),h({to:"/home"})))}catch(t){console.error("Error al registrar usuario:",(n=t.response)==null?void 0:n.status,(y=t.response)==null?void 0:y.data),t.response?o(t.response.data||"Error al registrar el usuario. Intenta nuevamente."):o("No se pudo conectar al servidor.")}else try{const t=await p.post("http://localhost:8080/api/cloud/authenticate",{username:l,password:c});t.status===200&&(t.data.requirePasswordChange?u(!0):(console.log("Inicio de sesión exitoso"),h({to:"/home"})))}catch(t){console.error("Error al iniciar sesión:",t),o("Usuario o contraseña incorrectos.")}};return A?e.jsxs("div",{className:"flex flex-col items-center justify-between w-screen h-screen bg-slate-100",children:[e.jsx("div",{className:"w-full flex justify-start p-4",children:e.jsx("img",{src:j,className:"w-[80px] p-2 h-auto",alt:"logo empresa"})}),e.jsxs("form",{className:"flex flex-col items-center justify-center w-[350px] bg-slate-100 p-12 text-[15px] text-aliceblue text-center box-content",onSubmit:g,children:[e.jsxs("div",{className:"flex flex-col space-y-5",children:[e.jsx("h2",{className:"font-bold",children:"Cambio de contraseña requerido"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{className:"relative w-[250px]",children:[e.jsx("input",{className:"py-[10px] px-4 border-2 border-[#ccc] rounded-[5px] font-sans text-[16px] w-full pr-12",type:b?"text":"password",value:d,placeholder:"Nueva contraseña",onChange:s=>S(s.target.value)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 border-2 border-[#ccc] rounded-[5px] px-3 py-2 text-sm text-[#0B6A8D]",onClick:()=>B(!b),children:a?"Hide":"Show"})]}),e.jsxs("div",{className:"relative w-[250px]",children:[e.jsx("input",{className:"py-[10px] px-4 border-2 border-[#ccc] rounded-[5px] font-sans text-[16px] w-full pr-12",type:a?"text":"password",value:f,placeholder:"Confirmar contraseña",onChange:s=>P(s.target.value)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 border-2 border-[#ccc] rounded-[5px] px-3 py-2 text-sm text-[#0B6A8D]",onClick:()=>m(!a),children:a?"Hide":"Show"})]})]}),i&&e.jsx("div",{className:"mt-4 px-4 py-2 text-red-500 bg-pink-200 rounded",children:i}),e.jsx("button",{type:"button",onClick:E,className:"no-underline text-white py-[10px] px-6 mt-10 font-bold text-aliceblue border-2 border-[#0B6A8D] bg-[#3F9BB9] rounded-[5px] w-[250px] cursor-pointer",children:"Cambiar contraseña"})]}),e.jsx("footer",{className:"w-full py-2 text-[10pt] text-center bg-[#3F9BB9] text-white",children:e.jsx("p",{children:"Copyright SpeedToCloud © 2023. All rights reserved."})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-between w-screen h-screen bg-slate-100",children:[e.jsx("div",{className:"w-full flex justify-start p-4",children:e.jsx("img",{src:j,className:"w-[80px] p-2 h-auto",alt:"logo empresa"})}),e.jsxs("form",{className:"flex flex-col items-center justify-center w-[350px] bg-slate-100 p-12 text-[15px] text-aliceblue text-center box-content",onSubmit:g,children:[e.jsxs("div",{className:"flex flex-col space-y-5",children:[e.jsx("h2",{className:"font-bold",children:"Welcome to STC APP WEB"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("p",{children:x?"Regístrate como nuevo usuario para comenzar.":"Ingresa tus credenciales para iniciar sesión."}),e.jsx("input",{className:"py-[10px] px-4 border-2 border-[#ccc] rounded-[5px] font-sans text-[16px] w-[250px]",value:l,placeholder:"User",onChange:s=>N(s.target.value)}),e.jsxs("div",{className:"relative w-[250px]",children:[e.jsx("input",{className:"py-[10px] px-4 border-2 border-[#ccc] rounded-[5px] font-sans text-[16px] w-full pr-12",type:a?"text":"password",value:c,placeholder:"Password",onChange:s=>v(s.target.value)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 border-2 border-[#ccc] rounded-[5px] px-3 py-2 text-sm text-[#0B6A8D]",onClick:()=>m(!a),children:a?"Hide":"Show"})]})]}),i&&e.jsx("div",{className:"mt-4 px-4 py-2 text-red-500 bg-pink-200 rounded",children:i}),e.jsx("button",{type:"submit",className:"no-underline text-white py-[10px] px-6 mt-10 font-bold text-aliceblue border-2 border-[#0B6A8D] bg-[#3F9BB9] rounded-[5px] w-[250px] cursor-pointer",children:x?"Register":"Login"})]}),e.jsx("footer",{className:"w-full py-2 text-[10pt] text-center bg-[#3F9BB9] text-white",children:e.jsx("p",{children:"Copyright SpeedToCloud © 2023. All rights reserved."})})]})},F=R("/")({component:I});export{F as Route};
